# 🔍 업비트 실데이터 검증 가이드

## ⚠️ 현재 상황

샌드박스 환경에서 업비트 API 접근이 차단되어 있어 실시간 데이터 수집이 불가합니다.
**로컬 환경**에서 아래 가이드를 따라 실제 업비트 데이터로 전략을 검증하세요.

---

## 📋 로컬 환경 검증 절차

### 1️⃣ 필수 패키지 설치

```bash
pip install requests python-dotenv pandas numpy
```

### 2️⃣ 검증 스크립트 실행

```bash
# 실제 업비트 데이터로 전략 검증
python validate_with_real_upbit_data.py
```

이 스크립트는:
- ✅ 업비트 공개 API에서 실제 시장 데이터 수집
- ✅ 비트코인(BTC), 이더리움(ETH), 리플(XRP) 3개 마켓 분석
- ✅ 가중 복합 전략 vs MA 단독 성능 비교
- ✅ 수익률, Sharpe Ratio, 승률 등 상세 지표 제공

### 3️⃣ 예상 출력 예시

```
================================================================================
📊 비트코인 (KRW-BTC) 분석
================================================================================

수집 기간:
  시작: 2025-11-01 10:00:00
  종료: 2025-11-09 13:00:00
  총 200개 캔들

가격 범위:
  최저: 110,500,000원
  최고: 115,800,000원
  현재: 114,200,000원
  변동: +3.35%

────────────────────────────────────────────────────────────────────────────────
🎯 가중 복합 전략 (RSI 0.3 + MA 0.7)
────────────────────────────────────────────────────────────────────────────────

결과:
  수익률:          +15.23%
  최종 잔고:     1,152,300원
  총 거래:              8회
  승률:              62.5%
  Sharpe:             2.35
  최대 낙폭:         -4.12%

────────────────────────────────────────────────────────────────────────────────
📉 MA Crossover 단독 (비교용)
────────────────────────────────────────────────────────────────────────────────

결과:
  수익률:           -2.15%
  최종 잔고:       978,500원
  총 거래:              4회
  승률:              25.0%
  Sharpe:            -0.42
  최대 낙폭:         -8.35%

────────────────────────────────────────────────────────────────────────────────
📈 개선 효과
────────────────────────────────────────────────────────────────────────────────
  수익률 개선:      +17.38%p
  Sharpe 개선:        +2.77
```

---

## 🎯 검증 체크리스트

### ✅ 단기 검증 (1주일)
- [ ] 3개 이상 주요 코인(BTC, ETH, XRP) 테스트
- [ ] 다양한 시간봉 테스트 (1시간, 4시간, 1일)
- [ ] 수익률 > 0% 확인
- [ ] Sharpe Ratio > 1.0 확인
- [ ] 승률 > 40% 확인

### ✅ 중기 검증 (1개월)
- [ ] Walk-forward 테스트 (학습 70% / 테스트 30%)
- [ ] 다양한 시장 조건 (상승/하락/횡보) 검증
- [ ] 최대 낙폭(MDD) < 20% 확인
- [ ] 거래 빈도 적절성 확인 (과매매 방지)

### ✅ 장기 검증 (3개월) - **필수**
- [ ] 페이퍼 트레이딩 (Dry-run 모드)
- [ ] 실시간 데이터로 신호 검증
- [ ] 슬리피지, 수수료 실제 영향 확인
- [ ] 안정적 수익률 유지 확인

---

## 🚨 실거래 전 필수 확인사항

### 1. 위험 관리 설정 확인

```python
# .env 파일 설정
STOP_LOSS_PCT=-5.0        # 손절: -5%
TAKE_PROFIT_PCT=10.0       # 익절: +10%
MAX_DAILY_LOSS_PCT=3.0     # 일일 최대 손실: 3%
MAX_POSITION_PCT=5.0       # 포지션 크기: 5%
```

### 2. 백테스트 vs 실거래 성능 비교

| 지표 | 백테스트 목표 | 실거래 허용 범위 |
|------|--------------|-----------------|
| 수익률 | > 0% | 백테스트 대비 70% 이상 |
| Sharpe | > 1.5 | 백테스트 대비 80% 이상 |
| 승률 | > 45% | 백테스트 대비 -10%p 이내 |
| MDD | < 20% | 백테스트 대비 +5%p 이내 |

**⚠️ 실거래 성능이 백테스트 대비 30% 이상 하락하면 즉시 중단!**

### 3. 점진적 투자 전략

```
1단계: 10만원 (1주)
  ↓ 수익률 > 0% 확인
2단계: 50만원 (1개월)
  ↓ 수익률 > 5% 확인
3단계: 100만원 (3개월)
  ↓ 수익률 > 10% 확인
4단계: 총자산의 5% (이후)
```

---

## 📊 성능 모니터링

### 일일 체크

```bash
# 로그 확인
tail -f logs/trading.log

# 수익률 확인
python scripts/check_performance.py --period=1d
```

### 주간 리포트

```bash
# 주간 성능 분석
python scripts/weekly_report.py

# 거래 내역 리뷰
python scripts/review_trades.py --days=7
```

### 월간 평가

- 백테스트 결과와 실거래 결과 비교
- 전략 파라미터 재최적화 검토
- 시장 조건 변화 분석

---

## 🛠️ 문제 해결

### 문제 1: 수익률이 지속적으로 마이너스

**원인:**
- 시장 조건이 백테스트 기간과 다름
- 슬리피지/수수료가 예상보다 높음
- 전략 과최적화 (Overfitting)

**해결:**
1. 전략 중단 (손절 -10% 도달 시)
2. 최근 3개월 데이터로 재최적화
3. Walk-forward 테스트 재실행
4. 파라미터 조정 후 페이퍼 트레이딩 재시작

### 문제 2: Sharpe Ratio 급격히 하락

**원인:**
- 변동성 증가
- 연속 손실로 인한 심리적 압박
- 잘못된 타이밍의 진입/청산

**해결:**
1. 포지션 크기 축소 (50%)
2. ATR Threshold 상향 (0.02 → 0.04)
3. 손절 폭 축소 (-5% → -3%)
4. 거래 빈도 줄이기 (신호 필터 강화)

### 문제 3: 과매매 (Overtrading)

**원인:**
- 너무 민감한 파라미터
- 잘못된 신호 필터

**해결:**
1. MA window 증가 (14 → 20)
2. RSI oversold/overbought 범위 축소 (30/70 → 25/75)
3. 최소 홀딩 시간 설정 (4시간)

---

## 📚 추가 자료

### 전략 문서
- `FINAL_STRATEGY_REPORT.md`: 복합 전략 성과 분석
- `OPTIMIZATION_REPORT.md`: 파라미터 최적화 결과
- `README.md`: 프로젝트 개요 및 경고사항

### 설정 파일
- `.env.example`: 상세 설정 가이드
- `upbit_bot/services/risk.py`: 리스크 관리 로직

### 테스트 스크립트
- `test_final_integration.py`: 통합 테스트
- `test_combined_strategies.py`: 복합 전략 테스트
- `validate_with_real_upbit_data.py`: 실데이터 검증

---

## ⚠️ 최종 경고

1. **과거 성능 ≠ 미래 수익**
   - 백테스트에서 52% 수익이 나왔다고 해서 실거래에서도 같은 결과를 보장하지 않습니다.

2. **시장 조건 변화**
   - 암호화폐 시장은 급변합니다. 3개월마다 재최적화가 필요합니다.

3. **심리적 압박**
   - 연속 손실 시 감정적 판단을 하지 마세요. 알고리즘을 신뢰하세요.

4. **절대 규칙**
   - ❌ 총 자산의 5% 이상 투자 금지
   - ❌ 레버리지 사용 금지
   - ❌ 손절가 무시 금지
   - ❌ 검증 없이 파라미터 변경 금지

---

## ✅ 성공 기준

### 3개월 후 평가

**최소 기준 (계속 운영):**
- 누적 수익률 > +10%
- Sharpe Ratio > 1.0
- 최대 낙폭 < -15%
- 월간 수익률 표준편차 < 5%

**목표 기준 (투자금 증액):**
- 누적 수익률 > +30%
- Sharpe Ratio > 2.0
- 최대 낙폭 < -10%
- 월간 수익률 표준편차 < 3%

**실패 기준 (즉시 중단):**
- 누적 수익률 < -10%
- 최대 낙폭 > -20%
- 연속 손실 > 5회
- Sharpe Ratio < 0

---

## 🎉 로드맵

```
현재 위치: 백테스트 완료 ✅
  ↓
1주차: 로컬 환경 실데이터 검증
  ↓
2-4주차: 페이퍼 트레이딩
  ↓
2개월차: 소액 실거래 (10만원)
  ↓
3개월차: 성능 평가 및 증액 결정
  ↓
6개월차: 안정화 및 자동화
  ↓
1년차: 포트폴리오 다각화
```

**지금 당장 할 일:**
1. ✅ `validate_with_real_upbit_data.py` 로컬에서 실행
2. ✅ 3개 마켓 성능 확인
3. ✅ 페이퍼 트레이딩 설정

**화이팅! 🚀**
